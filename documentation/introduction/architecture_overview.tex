The system architecture can be broken up into 4 high level component. The mobile interface, the web interface, the core system and agents that do work on data from the core system. Each of these high level component can be broken up into smaller subsystem. These subsystems are enumerated and their place in the system is explained with the diagram below.

\begin{figure}[h]
    \makebox[\textwidth][c]{\includegraphics[width=1.4\textwidth]{diagrams/layered_architecture.pdf}}
\caption{Architecture Overview}
\end{figure}
There is a lot going on in this diagram, so let us start with some of the conventions that we used to communicate how different subsystems relate to each other. The Dark blue is everything relates to GIS data. The purple is all data that gets persisted in the database. The Yellow is to show that add-ons exist on more than one of the user interfaces, namely Mobile and WebUI. The green is everything relates to add-ons. The Red is everything that relates to the position information of mobile devices. The Orange is everything that relates to user management. You will notice that the WebUI has an Administration component that is Orange, which manages anything user related in the User Management subsystem.\par
\bigskip
\noindent
Now that the colours have been described, let us give a cursory description of how some of these systems interact. First, let us  turn our attention to the Orange sections. Notice how every external subsystem must go through the User Management subsystem, this is needed to prevent any unauthorised access to privileged information or features. For example guests have certain add-on functionalities deactivated since there is no persistent ID to identify them by. Furthermore a user logged in as a student may not modify map feature, however, the Data Capture user on the WebUI may modify map features assuming it has been authenticated and has been given the right privilege level. Also notice that the User Management submodule must consult the database to retrieve user credentials, which is why the arrows go both ways.\par\noindent
Turning our attention to the Mobile add-ons, the reason why GIS data and position information flows into the add-ons section is that features such as Navigation requires information from both to function properly. The cache allows the app to attempt to do its work even though it is not connected.\par\noindent
The Data Stream and GIS subsystem is a bit harder to understand so let us go through that for the last part of our tour. The Data Stream takes live data stream of device positions and pushes it into a messaging system. Stream processors, which are registered in the messaging system, then generate metadata that can be used in the GIS subsystem. This metadata can be population densities and congestion data. Notice that the metadata is purple, therefore it gets commited to the database if necessary. Further analysis on the data stream may be done by the stream processors to generate other metadata such as user preference and interests for the add-ons. Both live and historical data may be needed for further analysis, which is why there are arrows from the Data Stream into the database.
